<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GALICIAN ELITISM | Official Store</title>
    
    <link rel="icon" type="image/png" href="logolev.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://www.paypal.com/sdk/js?client-id=AW73f-4c4tqF6NI_Xy6yEy8fXRwHkoclNuJYzxOJo2RE5xyMvbAadDvHMzj22jXmmSgWkQqWSzd49ivI&currency=EUR&components=buttons,applepay"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <style>
        :root {
            --bg: #000;
            --accent: #7e7e7e;
            --text: #fff;
            --border: #222;
            --card: #0a0a0a;
            --danger: #ff4444;
            --success: #2ecc71;
        }

        #splash-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999; display: flex; justify-content: center; align-items: center;
            transition: opacity 0.4s ease-out;
        }
        .splash-logo { height: 180px; opacity: 0; transform: scale(0.9); animation: fadeInScale 1s forwards ease-in-out; }
        @keyframes fadeInScale { to { opacity: 1; transform: scale(1); } }

        body { background-color: var(--bg); color: var(--text); font-family: 'Helvetica', Arial, sans-serif; margin: 0; overflow-x: hidden; }

        header { border-bottom: 1px solid var(--border); padding: 15px 5%; background: rgba(0,0,0,0.98); position: sticky; top: 0; z-index: 1000; }
        .top-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; gap: 20px; }
        .header-right { display: flex; align-items: center; gap: 20px; flex-grow: 1; justify-content: flex-end; }
        
        .search-box { position: relative; max-width: 200px; width: 100%; }
        .search-input { width: 100%; padding: 6px 30px 6px 12px; background: #111; border: 1px solid #333; color: white; border-radius: 4px; font-size: 11px; outline: none; }
        .search-icon { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); font-size: 10px; color: #555; }

        .logo-img { height: 120px; cursor: pointer; transition: 0.3s; display: block; margin: 0 auto; }
        
        .nav-bar { display: flex; flex-direction: column; align-items: center; margin-top: 15px; }
        .nav-links { display: flex; gap: 25px; }
        .nav-links a { color: var(--text); text-decoration: none; font-size: 10px; text-transform: uppercase; letter-spacing: 2px; cursor: pointer; opacity: 0.6; transition: 0.3s; }
        .nav-links a:hover { opacity: 1; }

        .band-dropdown { max-height: 0; overflow: hidden; transition: 0.4s ease; display: flex; gap: 15px; margin-top: 10px; }
        .band-dropdown.active { max-height: 50px; margin-top: 15px; padding-top: 10px; border-top: 1px solid #222; }
        .band-link { font-size: 9px; text-transform: uppercase; color: var(--accent); cursor: pointer; letter-spacing: 1px; }

        .shop-container { padding: 30px 5%; min-height: 60vh; }
        .band-section { margin-bottom: 60px; }
        .band-title { font-size: 14px; letter-spacing: 4px; text-transform: uppercase; border-bottom: 1px solid var(--border); padding-bottom: 10px; margin-bottom: 25px; }
        
        .product-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 25px; }
        @media (max-width: 900px) { .product-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 600px) { .product-grid { grid-template-columns: 1fr; } }

        .product-card { background: var(--card); border: 1px solid var(--border); padding: 20px; text-align: center; cursor: pointer; transition: 0.3s; position: relative; }
        .product-card:hover { border-color: #444; }

        .new-arrivals-hero { margin-bottom: 80px; padding-bottom: 40px; border-bottom: 1px solid #333; }
        .new-arrivals-title { font-size: 18px; letter-spacing: 6px; text-align: center; margin-bottom: 30px; color: #fff; text-transform: uppercase; }
        .badge-container { position: absolute; top: 10px; left: 10px; display: flex; flex-direction: column; gap: 4px; z-index: 5; }

        .zoom-container { position: relative; width: 100%; height: 350px; overflow: hidden; cursor: zoom-in; margin-bottom: 15px; background: #050505; display: flex; align-items: center; }
        .zoom-img { width: 100%; height: 100%; object-fit: contain; transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94); transform-origin: center center; }
        .zoom-container.is-active { cursor: zoom-out; }
        
        .slider-nav { position: absolute; top: 50%; width: 100%; display: flex; justify-content: space-between; transform: translateY(-50%); pointer-events: none; z-index: 10; }
        .slider-btn { background: rgba(0,0,0,0.5); color: white; border: none; padding: 10px; cursor: pointer; pointer-events: auto; opacity: 0.7; transition: 0.3s; }
        .slider-btn:hover { opacity: 1; background: #000; }

        .status-badge { font-size: 8px; padding: 3px 7px; text-transform: uppercase; font-weight: bold; width: fit-content; }
        .available { background: var(--success); color: #000; }
        .stock-left { background: var(--danger); color: #fff; }
        .new-arrival { background: #fff; color: #000; }
        .sold-out { background: #555; color: #000; }
        .sub-available { background: var(--success); color: #000; font-size: 7px; }

        .ua-note { color: var(--accent); font-size: 11px; margin-top: 10px; border-top: 1px solid #222; padding-top: 10px; text-align: left; }
        .release-info { display: block; margin-top: 5px; font-weight: bold; letter-spacing: 1px; color: #555; text-transform: uppercase; font-size: 9px; }

        .sidebar { position: fixed; right: -420px; top: 0; width: 400px; height: 100%; background: #050505; border-left: 1px solid var(--border); transition: 0.4s; z-index: 2000; padding: 25px; box-sizing: border-box; overflow-y: auto; }
        .sidebar.active { right: 0; }

        .input-field { width: 100%; padding: 12px; margin-bottom: 10px; background: #000; border: 1px solid var(--border); color: white; box-sizing: border-box; font-size: 12px; }
        .qty-controls { display: flex; align-items: center; border: 1px solid #333; width: fit-content; margin: 5px 0; }
        .qty-btn { background: none; border: none; color: white; padding: 5px 12px; cursor: pointer; }

        .modal { display: none; position: fixed; z-index: 3000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.96); }
        .modal-content { background: #0a0a0a; margin: 5% auto; padding: 30px; width: 90%; max-width: 450px; border: 1px solid var(--border); position: relative; }

        footer { border-top: 1px solid var(--border); padding: 40px 5%; text-align: center; margin-top: 40px; color: #444; font-size: 10px; }
        
        .auth-toggle { color: var(--accent); font-size: 10px; cursor: pointer; text-decoration: underline; margin-top: 15px; display: inline-block; }
        .user-logged { color: var(--success) !important; }

        .size-selector { margin: 15px 0; display: flex; gap: 10px; align-items: center; }
        .size-label { font-size: 10px; color: var(--accent); text-transform: uppercase; }
        .size-select { background: #000; color: #fff; border: 1px solid #333; padding: 5px; font-size: 12px; outline: none; }
        /* Оптимізація для мобільних пристроїв */
@media (max-width: 768px) {
    /* 1. Виправляємо логотип на сплеш-скріні */
    .splash-logo {
        height: auto;
        width: 60%; /* Логотип не буде виходити за межі екрану */
        max-width: 250px;
    }

    /* 2. Виправляємо головне лого в шапці */
    .logo-img {
        height: 80px; /* Зменшуємо висоту для мобільних */
        width: auto;
    }

    /* 3. Центруємо товари та виправляємо сітку */
    .product-grid {
        display: grid;
        grid-template-columns: 1fr 1fr; /* Робимо 2 колонки на мобілці */
        gap: 15px;
        padding: 0 10px;
    }

    .product-card {
        padding: 10px;
        display: flex;
        flex-direction: column;
        align-items: center; /* Центруємо вміст картки */
    }

    /* 4. Навігація */
    .nav-links {
        gap: 10px;
        flex-wrap: wrap; /* Щоб посилання не вилазили за екран */
        justify-content: center;
    }

    .nav-links a {
        font-size: 9px;
        letter-spacing: 1px;
    }

    /* 5. Сайдбар кошика */
    .sidebar {
        width: 100% !important; /* Кошик на весь екран на мобілці */
        right: -100%;
    }

    /* 6. Модальне вікно товару */
    .modal-content {
        width: 95%;
        margin: 10% auto;
        padding: 15px;
        box-sizing: border-box;
    }

    .zoom-container {
        height: 250px; /* Менша висота фото на мобілці */
    }

    /* 7. Усуваємо горизонтальний скрол */
    body, html {
        overflow-x: hidden;
        position: relative;
        width: 100%;
    }
}

/* Додаткове виправлення для дуже маленьких екранів */
@media (max-width: 480px) {
    .product-grid {
        grid-template-columns: 1fr; /* 1 колонка, якщо екран зовсім малий */
    }
    
    .top-row {
        flex-direction: row;
        justify-content: space-between;
    }
}
/* PROFESSIONAL MOBILE OPTIMIZATION (Senior Grade) */
@media (max-width: 768px) {
    /* 1. Виправляємо "стиснутість" сайту - даємо дихати контенту */
    .shop-container {
        padding: 20px 15px;
        width: 100%;
        box-sizing: border-box;
    }

    /* 2. Сплеш-скрін: логотип більше не стиснутий, зберігає пропорції */
    .splash-logo {
        height: auto;
        width: 70vw; /* 70% від ширини екрану */
        max-width: 300px;
        object-fit: contain;
    }

    /* 3. Шапка сайту: вирівнюємо елементи, щоб не було каші */
    header {
        padding: 10px 15px;
    }

    .top-row {
        gap: 10px;
    }

    .logo-img {
        height: 90px; /* Оптимальний розмір для мобільного */
        width: auto;
    }

    /* 4. Навігація: робимо посилання зручними для натискання пальцем */
    .nav-links {
        gap: 12px;
        flex-wrap: wrap;
        justify-content: center;
    }

    .nav-links a {
        font-size: 11px; /* Трохи більший шрифт для читабельності */
        padding: 5px 0;
    }

    /* 5. Сітка товарів: 2 колонки замість 1, щоб не було пустих місць */
    .product-grid {
        display: grid;
        grid-template-columns: 1fr 1fr; 
        gap: 12px;
    }

    .product-card {
        padding: 12px;
        box-sizing: border-box;
    }

    .zoom-container {
        height: 220px; /* Адаптуємо висоту фото в модалці */
    }

    /* 6. Сайдбар кошика: на весь екран, щоб зручно було вводити дані */
    .sidebar {
        width: 100%;
        right: -100%;
        padding: 20px;
    }

    /* 7. Форми та інпути: прибираємо автоматичне наближення в iOS */
    .input-field {
        font-size: 16px !important; /* Мінімальний розмір для запобігання зуму */
    }

    /* 8. Запобігаємо горизонтальному скролу (сайт більше не буде "гуляти") */
    html, body {
        overflow-x: hidden;
        width: 100%;
        position: relative;
    }
}

/* Спеціально для дуже вузьких екранів (менше 400px) */
@media (max-width: 400px) {
    .product-grid {
        grid-template-columns: 1fr; /* Одна колонка, якщо екран зовсім малий */
    }
}
    </style>
</head>
<body>

<div id="splash-screen"><img src="Galician.jpg.jpg" class="splash-logo"></div>

<header>
    <div class="top-row">
        <select id="currencySelect" onchange="updateCurrency()" style="background:black; color:white; border:1px solid #333; font-size:10px;">
            <option value="EUR">€ EUR</option>
            <option value="USD">$ USD</option>
        </select>
        <div class="header-right">
            <div class="search-box">
                <input type="text" id="searchInput" class="search-input" placeholder="Search..." oninput="handleSearch()">
                <i class="fa-solid fa-magnifying-glass search-icon"></i>
            </div>
            <div class="user-controls" style="display:flex; gap:15px; font-size: 18px;">
                <i class="fa-solid fa-circle-user" id="userBtn" onclick="openModal('authModal')" style="cursor:pointer;"></i>
                <div onclick="toggleCart()" style="cursor:pointer; position:relative;">
                    <i class="fa-solid fa-cart-shopping"></i>
                    <span id="cart-count" style="position:absolute; top:-10px; right:-10px; background:#fff; color:#000; font-size:9px; padding:2px 5px; border-radius:50%; font-weight:bold;">0</span>
                </div>
            </div>
        </div>
    </div>
    <img src="Galician.jpg.jpg" class="logo-img" onclick="filterCat('all')">
    <div class="nav-bar">
        <nav class="nav-links">
            <a onclick="filterCat('all')">Home</a>
            <a onclick="filterCat('cassette')">Cassettes</a>
            <a onclick="filterCat('cd')">CD's</a>
            <a onclick="filterCat('flag')">Flags</a>
            <a onclick="filterCat('merch')">Merch</a>
        </nav>
        <div id="bandDropdown" class="band-dropdown">
            <div class="band-link" onclick="filterBand('Winguricht')"><i class="fa-solid fa-chevron-right" style="font-size:7px;"></i> Winguricht</div>
        </div>
    </div>
</header>

<main class="shop-container" id="productGrid"></main>

<div id="prodModal" class="modal">
    <div class="modal-content">
        <span onclick="closeModal('prodModal')" style="position:absolute; right:20px; top:10px; cursor:pointer; z-index:100;">✕</span>
        <div id="prodDetailContent"></div>
    </div>
</div>

<div id="cartSidebar" class="sidebar">
    <h3 style="letter-spacing: 2px; font-size: 16px; border-bottom: 1px solid #222; padding-bottom: 10px;">ORDER SUMMARY</h3>
    <div id="cartItems" style="margin: 20px 0;"></div>
    
    <div id="checkoutSection" style="display:none; border-top: 1px solid #222; padding-top: 20px;">
        <div style="font-size:12px; line-height: 2; margin-bottom: 20px;">
            <div style="display:flex; justify-content:space-between;">Subtotal: <span id="sub-val"></span></div>
            <div style="display:flex; justify-content:space-between;">Tax: <span id="tax-val"></span></div>
            <div style="display:flex; justify-content:space-between;">Shipping: <span id="ship-val"></span></div>
            <div style="display:flex; justify-content:space-between; font-weight:bold; font-size:15px; border-top:1px solid #333; margin-top:5px;">TOTAL: <span id="total-val"></span></div>
        </div>

        <p style="font-size:9px; color:var(--accent); text-transform:uppercase;">Shipping Info:</p>
        <input type="text" id="clientName" class="input-field" placeholder="Full Name">
        <input type="email" id="clientEmail" class="input-field" placeholder="Email Address">
        <input type="text" id="clientPhone" class="input-field" placeholder="Phone Number">
        <textarea id="clientAddress" class="input-field" placeholder="Address (Country, City, Zip...)" style="height:60px;"></textarea>
        
        <p style="font-size:9px; color:var(--accent);">DESTINATION:</p>
        <select id="countrySelect" class="input-field" onchange="updateUI()">
            <option value="UA">Ukraine (Direct Pay)</option>
            <option value="PL">Poland</option>
            <option value="DE">Germany</option>
            <option value="FR">France</option>
            <option value="GB">United Kingdom</option>
            <option value="IT">Italy</option>
            <option value="ES">Spain</option>
            <option value="CZ">Czech Republic</option>
            <option value="AT">Austria</option>
            <option value="BE">Belgium</option>
            <option value="NL">Netherlands</option>
            <option value="CH">Switzerland</option>
            <option value="SE">Sweden</option>
            <option value="NO">Norway</option>
            <option value="DK">Denmark</option>
            <option value="FI">Finland</option>
            <option value="IE">Ireland</option>
            <option value="PT">Portugal</option>
            <option value="HU">Hungary</option>
            <option value="RO">Romania</option>
            <option value="GR">Greece</option>
            <option value="LT">Lithuania</option>
            <option value="LV">Latvia</option>
            <option value="EE">Estonia</option>
            <option value="US">USA</option>
            <option value="CA">Canada</option>
            <option value="OTHER">Other Countries</option>
        </select>

        <div id="paypal-button-container" style="margin-top:20px;"></div>
    </div>
    <button onclick="toggleCart(false)" style="width:100%; padding:12px; background:none; color:white; border:1px solid #333; cursor:pointer; margin-top:10px;">RETURN</button>
</div>

<div id="authModal" class="modal">
    <div class="modal-content" id="authContent" style="text-align:center;">
        <span onclick="closeModal('authModal')" style="position:absolute; right:20px; top:10px; cursor:pointer;">✕</span>
        <div id="authFormContainer">
            <h3>RESERVIST ACCESS</h3>
            <div id="authInputs">
                <input type="email" id="authEmail" class="input-field" placeholder="Email">
                <input type="password" id="authPass" class="input-field" placeholder="Password">
            </div>
            <button onclick="handleAuth()" id="authMainBtn" style="width:100%; padding:12px; background:#fff; color:#000; border:none; font-weight:bold; margin-top:10px;">LOGIN</button>
            <span class="auth-toggle" onclick="toggleAuthMode()" id="authToggleBtn">Don't have an account? Register</span>
        </div>
    </div>
</div>

<footer>
    <div class="footer-socials" style="margin-bottom:15px; font-size:18px;">
        <a href="https://www.instagram.com/glcneltsm/" target="_blank" style="color:#444; margin:0 10px;"><i class="fa-brands fa-instagram"></i></a>
        <a href="https://www.youtube.com/@Chornovovk" target="_blank" style="color:#444; margin:0 10px;"><i class="fa-brands fa-youtube"></i></a>
    </div>
    CONTACT: galicianelitism@gmail.com<br>
    GALICIAN ELITISM © all rights reserved 2026.
</footer>

<script>
    const PUBLIC_KEY = "YOUR_PUBLIC_KEY"; 
    const SERVICE_ID = "YOUR_SERVICE_ID"; 
    const TEMPLATE_ID = "YOUR_TEMPLATE_ID";

    (function() { if(typeof emailjs !== 'undefined') emailjs.init(PUBLIC_KEY); })();

    const PAY_EMAIL = "winguricht14@gmail.com";
    const CONTACT_EMAIL = "galicianelitism@gmail.com";

    const products = [
        { id: 1, band: 'Winguricht', cat: 'cassette', name: 'Winguricht - Зими й Пристрасті (cassette)', price: 10, img : ['grim.jpg'], stock: 'available', ua_price: 400 },
        { id: 2, band: 'Winguricht', cat: 'cassette', name: 'Winguricht - Spirit of Ashes (cassette)', price: 8, img: ['spirit.jpg'], stock: 'available', ua_price: 400 },
        { id: 3, band: 'Winguricht', cat: 'cassette', name: 'Winguricht - Spirit of Ashes (cassette,Wiligut Prophecy)', price: 8, img: ['duh.jpg.jpg'], stock: 'left 1', ua_price: 400},
        { id: 4, band: 'Winguricht', cat: 'cassette', name: 'Winguricht - Sorrow of Spilled Blood (cassette)', price: 8, img: ['Sorrow.jpg.jpg'], stock: 'available', ua_price: 400 },
        { id: 5, band: 'Winguricht', cat: 'cassette', name: 'Winguricht - Sorrow of Spilled Blood (cassette,Wiligut Prophecy)', price: 8, img: ['wiliguts.jpg'], stock: 'available', ua_price: 400 },
        { id: 6, band: 'Winguricht', cat: 'cd', name: 'Winguricht - Spirit of Ashes (CD)', price: 10, img: ['cd spirit.jpg'], stock: 'left 2', ua_price: 400 },
        { id: 7, band: 'Winguricht', cat: 'cd', name: 'Winguricht - Sorrow of Spilled Blood (CD)', price: 10, img: ['CD sorrow.jpg'], stock: 'left 2', ua_price: 400 },
        { id: 8, band: 'Winguricht', cat: 'flag', name: 'Winguricht - Old Logo Flag (90x150)', price: 16, img: ['flag.jpg.jpg'], stock: 'new arrival', ua_price: 800 },
        { id: 9, band: 'Winguricht', cat: 'flag', name: 'Winguricht - New Logo Flag (90x150)', price: 13, img: ['newflag.jpg'], stock: 'new arrival', ua_price: 600 },
        { id: 10, band: 'Winguricht', cat: 'merch', name: 'Winguricht - Зими й Пристрасті (Merch)', price: 21, img: ['1.jpg','2.jpg', 'elitism.jpg', '3.jpg'], stock: 'new arrival', ua_price: 850, sizes: ['S', 'M', 'L'] },
        { id: 11, band: 'Winguricht', cat: 'merch', name: 'Winguricht - Spirit of Ashes (Merch)', price: 21, img: ['merch_1.jpg'], stock: 'sold out', ua_price: 850 },
    ];

    const countryData = {
        'UA': { tax: 0, ship: 3 }, 'PL': { tax: 0.23, ship: 10 }, 'DE': { tax: 0.19, ship: 13 },
        'FR': { tax: 0.20, ship: 14 }, 'GB': { tax: 0.20, ship: 17 }, 'IT': { tax: 0.22, ship: 14 },
        'ES': { tax: 0.21, ship: 15 }, 'CZ': { tax: 0.21, ship: 11 }, 'AT': { tax: 0.20, ship: 13 },
        'BE': { tax: 0.21, ship: 14 }, 'NL': { tax: 0.21, ship: 14 }, 'CH': { tax: 0.08, ship: 18 },
        'SE': { tax: 0.25, ship: 16 }, 'NO': { tax: 0.25, ship: 20 }, 'DK': { tax: 0.25, ship: 16 },
        'FI': { tax: 0.24, ship: 17 }, 'IE': { tax: 0.23, ship: 17 }, 'PT': { tax: 0.23, ship: 16 },
        'HU': { tax: 0.27, ship: 12 }, 'RO': { tax: 0.19, ship: 12 }, 'GR': { tax: 0.24, ship: 16 },
        'LT': { tax: 0.21, ship: 12 }, 'LV': { tax: 0.21, ship: 12 }, 'EE': { tax: 0.20, ship: 12 },
        'US': { tax: 0.08, ship: 22 }, 'CA': { tax: 0.12, ship: 22 }, 'OTHER': { tax: 0.21, ship: 25 }
    };

    let cart = [];
    let isZoomed = false;
    let currentSlide = 0;
    let currentUser = JSON.parse(localStorage.getItem('ge_user')) || null;
    let isRegisterMode = false;

    const rates = { EUR: 1, USD: 1.08 };
    const symbols = { EUR: '€', USD: '$' };

    function render(items) {
        const cur = document.getElementById('currencySelect').value;
        const grid = document.getElementById('productGrid');
        const isHomePage = items.length === products.length;

        let htmlContent = '';

        if (isHomePage) {
            const newArrivals = items.filter(p => p.stock === 'new arrival');
            if (newArrivals.length > 0) {
                htmlContent += `
                    <div class="new-arrivals-hero">
                        <div class="new-arrivals-title">⌖ NEW ARRIVALS ⌖</div>
                        <div class="product-grid">
                            ${newArrivals.map(p => generateCardHTML(p, cur)).join('')}
                        </div>
                    </div>
                `;
                items = items.filter(p => p.stock !== 'new arrival');
            }
        }

        const grouped = items.reduce((acc, obj) => {
            const key = obj.band || 'Other';
            if (!acc[key]) acc[key] = [];
            acc[key].push(obj);
            return acc;
        }, {});

        htmlContent += Object.keys(grouped).map(bandName => `
            <section class="band-section">
                <div class="band-title">${bandName}</div>
                <div class="product-grid">
                    ${grouped[bandName].map(p => generateCardHTML(p, cur)).join('')}
                </div>
            </section>
        `).join('');

        grid.innerHTML = htmlContent;
    }

    function generateCardHTML(p, cur) {
        let badgeClass = p.stock === 'sold out' ? 'sold-out' : (p.stock === 'new arrival' ? 'new-arrival' : (p.stock.includes('left') ? 'stock-left' : 'available'));
        let badgeText = p.stock.toUpperCase();
        const displayImg = Array.isArray(p.img) ? p.img[0] : p.img;
        
        return `
            <div class="product-card" onclick="${p.stock === 'sold out' ? '' : `viewProduct(${p.id})`}" style="${p.stock === 'sold out' ? 'opacity: 0.6; cursor: default;' : ''}">
                <div class="badge-container">
                    <span class="status-badge ${badgeClass}">${badgeText}</span>
                    ${p.stock === 'new arrival' ? '<span class="status-badge sub-available">AVAILABLE</span>' : ''}
                </div>
                <img src="${displayImg}" style="width:100%; height:200px; object-fit:contain;">
                <div style="font-weight:bold; margin-top:15px; font-size:11px;">${p.name}</div>
                <div style="margin-top:8px; color:var(--accent); font-size:12px;">${symbols[cur]} ${(p.price * rates[cur]).toFixed(2)} / ${p.ua_price} UAH</div>
            </div>
        `;
    }

    function viewProduct(id) {
        const p = products.find(x => x.id === id);
        if (p.stock === 'sold out') return;
        
        const cur = document.getElementById('currencySelect').value;
        isZoomed = false;
        currentSlide = 0;
        
        let label = "Released by Chornovovk";
        if (p.cat === 'cd') label = "Released by Kulturkampf Records";
        else if (p.name.includes('Wiligut Prophecy')) label = "Released by Wiligut Prophecy";

        const images = Array.isArray(p.img) ? p.img : [p.img];

        let sizeHtml = '';
        if(p.sizes) {
            sizeHtml = `
                <div class="size-selector">
                    <span class="size-label">Select Size:</span>
                    <select id="sizeSelect" class="size-select">
                        ${p.sizes.map(s => `<option value="${s}">${s}</option>`).join('')}
                    </select>
                </div>
            `;
        }

        document.getElementById('prodDetailContent').innerHTML = `
            <div class="zoom-container" id="mainZoomContainer" onclick="toggleZoom(event)" onmousemove="handleZoom(event)" onmouseleave="resetZoom(event)">
                <img src="${images[0]}" class="zoom-img" id="productZoomImg">
                ${images.length > 1 ? `
                    <div class="slider-nav">
                        <button class="slider-btn" onclick="changeSlide(event, ${id}, -1)">❮</button>
                        <button class="slider-btn" onclick="changeSlide(event, ${id}, 1)">❯</button>
                    </div>
                ` : ''}
            </div>
            <h3 style="font-size: 16px;">${p.name}</h3>
            <div style="font-size:18px; font-weight:bold;">${symbols[cur]} ${(p.price * rates[cur]).toFixed(2)}</div>
            ${sizeHtml}
            <div class="ua-note">
                Для України: <b>${p.ua_price} грн</b>. Контакт: <b>${CONTACT_EMAIL}</b>
                <span class="release-info">${label}</span>
            </div>
            <button onclick="addToCart(${p.id})" style="margin-top:20px; width:100%; padding:12px; background:#fff; color:#000; border:none; font-weight:bold; cursor:pointer;">ADD TO CART</button>
        `;
        openModal('prodModal');
    }

    function changeSlide(e, prodId, delta) {
        e.stopPropagation();
        const p = products.find(x => x.id === prodId);
        const images = Array.isArray(p.img) ? p.img : [p.img];
        currentSlide += delta;
        if (currentSlide >= images.length) currentSlide = 0;
        if (currentSlide < 0) currentSlide = images.length - 1;
        const imgEl = document.getElementById('productZoomImg');
        imgEl.src = images[currentSlide];
        resetZoom({ currentTarget: document.getElementById('mainZoomContainer') });
    }

    function toggleZoom(e) {
        isZoomed = !isZoomed;
        const container = e.currentTarget;
        const img = container.querySelector('.zoom-img');
        if (isZoomed) {
            container.classList.add('is-active');
            handleZoom(e);
        } else {
            container.classList.remove('is-active');
            img.style.transform = "scale(1)";
        }
    }

    function handleZoom(e) {
        if (!isZoomed) return;
        const container = e.currentTarget;
        const img = container.querySelector('.zoom-img');
        const rect = container.getBoundingClientRect();
        const x = ((e.clientX - rect.left) / rect.width) * 100;
        const y = ((e.clientY - rect.top) / rect.height) * 100;
        img.style.transformOrigin = `${x}% ${y}%`;
        img.style.transform = "scale(2.5)";
    }

    function resetZoom(e) {
        isZoomed = false;
        const container = e.currentTarget;
        const img = container.querySelector('.zoom-img');
        if(container) container.classList.remove('is-active');
        if(img) img.style.transform = "scale(1)";
    }

    function toggleAuthMode() {
        isRegisterMode = !isRegisterMode;
        document.getElementById('authMainBtn').innerText = isRegisterMode ? 'REGISTER' : 'LOGIN';
        document.getElementById('authToggleBtn').innerText = isRegisterMode ? 'Back to Login' : "Don't have an account? Register";
    }

    function handleAuth() {
        const email = document.getElementById('authEmail').value;
        if(!email.includes('@')) { alert('Please enter a valid email'); return; }
        currentUser = { email: email };
        localStorage.setItem('ge_user', JSON.stringify(currentUser));
        updateUserUI();
        closeModal('authModal');
    }

    function logout() {
        localStorage.removeItem('ge_user');
        currentUser = null;
        updateUserUI();
    }

    function updateUserUI() {
        const userBtn = document.getElementById('userBtn');
        if(currentUser) {
            userBtn.classList.add('user-logged');
            document.getElementById('authContent').innerHTML = `
                <span onclick="closeModal('authModal')" style="position:absolute; right:20px; top:10px; cursor:pointer;">✕</span>
                <h3>WELCOME</h3>
                <p style="font-size:12px; color:var(--accent);">${currentUser.email}</p>
                <div style="border-top: 1px solid #222; margin: 20px 0; padding-top:10px;">
                    <p style="font-size:10px;">Order History: empty</p>
                </div>
                <button onclick="logout()" style="width:100%; padding:10px; background:none; border:1px solid var(--danger); color:var(--danger); cursor:pointer;">LOGOUT</button>
            `;
        } else {
            userBtn.classList.remove('user-logged');
            document.getElementById('authContent').innerHTML = `
                <span onclick="closeModal('authModal')" style="position:absolute; right:20px; top:10px; cursor:pointer;">✕</span>
                <h3>RESERVIST ACCESS</h3>
                <input type="email" id="authEmail" class="input-field" placeholder="Email">
                <input type="password" id="authPass" class="input-field" placeholder="Password">
                <button onclick="handleAuth()" id="authMainBtn" style="width:100%; padding:12px; background:#fff; color:#000; border:none; font-weight:bold; margin-top:10px;">LOGIN</button>
                <span class="auth-toggle" onclick="toggleAuthMode()" id="authToggleBtn">Don't have an account? Register</span>
            `;
        }
    }

    function addToCart(id) {
        const p = products.find(x => x.id === id);
        const selectedSize = document.getElementById('sizeSelect') ? document.getElementById('sizeSelect').value : null;
        const cartKey = selectedSize ? `${id}-${selectedSize}` : id;
        
        const existing = cart.find(x => x.cartKey === cartKey);
        if (existing) {
            existing.qty++;
        } else {
            cart.push({ 
                ...p, 
                qty: 1, 
                cartKey: cartKey, 
                selectedSize: selectedSize,
                name: selectedSize ? `${p.name} [${selectedSize}]` : p.name 
            });
        }
        updateUI(); toggleCart(true); closeModal('prodModal');
    }

    function changeQty(idx, delta) {
        cart[idx].qty += delta;
        if (cart[idx].qty < 1) cart.splice(idx, 1);
        updateUI();
    }

    function updateUI() {
        const cur = document.getElementById('currencySelect').value;
        const country = document.getElementById('countrySelect').value;
        const data = countryData[country];
        const sub = cart.reduce((a, b) => a + (b.price * b.qty), 0);
        const tax = sub * data.tax;
        const total = sub + tax + data.ship;
        document.getElementById('cart-count').innerText = cart.reduce((a, b) => a + b.qty, 0);
        
        if(cart.length > 0) {
            document.getElementById('checkoutSection').style.display = 'block';
            document.getElementById('sub-val').innerText = symbols[cur] + (sub * rates[cur]).toFixed(2);
            document.getElementById('tax-val').innerText = symbols[cur] + (tax * rates[cur]).toFixed(2);
            document.getElementById('ship-val').innerText = symbols[cur] + (data.ship * rates[cur]).toFixed(2);
            document.getElementById('total-val').innerText = symbols[cur] + (total * rates[cur]).toFixed(2);
            document.getElementById('cartItems').innerHTML = cart.map((i, idx) => `
                <div style="padding:10px 0; border-bottom:1px solid #111; display:flex; justify-content:space-between; align-items:center;">
                    <div style="font-size:11px;"><b>${i.name}</b><div class="qty-controls"><button class="qty-btn" onclick="changeQty(${idx},-1)">-</button><span>${i.qty}</span><button class="qty-btn" onclick="changeQty(${idx},1)">+</button></div></div>
                    <span style="font-size:11px;">${symbols[cur]} ${(i.price * i.qty * rates[cur]).toFixed(2)}</span>
                </div>`).join('');
            if(country !== 'UA') initPayPal(total);
            else document.getElementById('paypal-button-container').innerHTML = `<p style="color:var(--success); font-size:10px; text-align:center; padding:10px; border:1px dashed #2ecc71;">Для замовлення в Україні напишіть нам в Instagram або на Email.</p>`;
        } else {
            document.getElementById('checkoutSection').style.display = 'none';
            document.getElementById('cartItems').innerHTML = "Cart is empty.";
        }
    }

    function initPayPal(amount) {
        const container = document.getElementById('paypal-button-container');
        container.innerHTML = '';
        if(typeof paypal === 'undefined') return;
        paypal.Buttons({
            style: { layout: 'vertical', color: 'black', shape: 'rect' },
            createOrder: (data, actions) => actions.order.create({ purchase_units: [{ amount: { value: amount.toFixed(2) }, payee: { email_address: PAY_EMAIL } }] }),
            onApprove: (data, actions) => actions.order.capture().then(details => {
                const templateParams = {
                    user_name: document.getElementById('clientName').value,
                    user_email: document.getElementById('clientEmail').value,
                    user_phone: document.getElementById('clientPhone').value,
                    address: document.getElementById('clientAddress').value,
                    order_details: cart.map(i => `${i.name} (x${i.qty})`).join(", "),
                    total_paid: amount.toFixed(2) + " EUR"
                };
                emailjs.send(SERVICE_ID, TEMPLATE_ID, templateParams).then(() => {
                    alert('THANK YOU! ORDER PLACED.');
                    cart = []; updateUI(); toggleCart(false);
                });
            })
        }).render('#paypal-button-container');
    }

    function handleSearch() {
        const q = document.getElementById('searchInput').value.toLowerCase();
        render(products.filter(p => p.name.toLowerCase().includes(q) || p.band.toLowerCase().includes(q)));
    }

    function filterCat(cat) { 
        if (cat === 'all') { render(products); hideBands(); } 
        else { render(products.filter(p => p.cat === cat)); toggleBands(); }
    }

    function filterBand(band) { render(products.filter(p => p.band === band)); }
    function toggleBands() { document.getElementById('bandDropdown').classList.add('active'); }
    function hideBands() { document.getElementById('bandDropdown').classList.remove('active'); }
    function toggleCart(open = null) { 
        const sb = document.getElementById('cartSidebar');
        if(open !== null) open ? sb.classList.add('active') : sb.classList.remove('active');
        else sb.classList.toggle('active');
    }
    function openModal(id) { document.getElementById(id).style.display = 'block'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    function updateCurrency() { render(products); updateUI(); }

    window.onload = () => {
        setTimeout(() => {
            const ss = document.getElementById('splash-screen');
            if(ss) { ss.style.opacity = '0'; setTimeout(() => ss.remove(), 400); }
        }, 800);
        updateUserUI();
        render(products);
    };
</script>
</body>
</html>